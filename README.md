# SNS 플랫폼 스느스

# 소개
프론트엔드, 백엔드 개발 및 퍼블릭 클라우드 환경을 이용한 배포를 진행 중인 개인 프로젝트입니다.<br>
2024년 12월부터 진행 중인 프로젝트이며 배포 후에도 지속적으로 문제를 찾아 해결하거나 서비스 업데이트를 진행하고 있습니다.

https://seuneuseu.com 를 통해 직접 이용해 보실 수 있습니다!

# 서비스 아키텍처
![제목 없는 다이어그램-2-2 drawio](https://github.com/user-attachments/assets/59ca8841-7466-47c1-a8e8-2522bb45729d)

# 기능
- 구글 로그인
- 게시글 작성/수정/삭제
- 댓글 및 답글 작성/삭제
- 팔로우/팔로잉 및 팔로잉 게시글 모아보기
- 사용자 검색
- 프로필 수정

# 개발
- 게시글의 데이터 중 댓글의 개수는 해당 게시글 댓글 수를 디비에서 세는 것이 아닌 각 댓글 작성 시마다 게시글 댓글 필드의 값을 1씩 증가시켜 주는 방식으로 되어있음.
  - 이는 근데 여러 사용자가 댓글을 동시에 달 경우 동시성 문제가 발생할 확률이 존재
  - 해결 방법 3가지가 존재 ( 낙관적 락으로 해결 )
    - 비관적 락: 실제 DB에 쓰기 락 걸고 진행     < 불필요한 성능 저하
    - 낙관적 락                                 < 한 게시글 내에서 댓글이 곂칠 일이 그렇게 많지 않음
      - 마지막 댓글 작성 시간을 게시글 DB에서 관리하고 이 값을 바탕으로 낙관적 락 진행, 최대 시도 횟수 3회
    - 주기적으로 댓글 개수 따로 업데이트         < 굳이?
- 게시글을 불러올 때 백엔드에서 무수한 양의 select를 날리는 것을 확인
  - 이는 게시글을 불러올 때 함께 가져오는 사용자 프로필 정보와 게시글 이미지 테이블에서 이미지 정보를 가져오는 N + 1 문제임
    - fetch join 방식을 이용하여 해결하고 JAVA 페이징을 fetch join과 함께 사용할 수 없기 때문에, 페이징 처리할 게시글 아이디 값을 따로 추출한 후 이 값으로 직접 페이징 처리 

# issue
- 2025.01.12 : CORS 문제 발생
  - 원인 : 도메인 이름으로 접근 시에 https(443)가 아닌 http(80)로 접근이 되어서 발생하던 문제. 백엔드 CORS Origin 경로는 'https://도메인'에 대해서만 허용해두었기 때문
  - 해결 : AWS ALB에서 80포트에 리스너를 설정하여 http 접근 시 https로 리다이렉션 되도록 설정해두어 해결했습니다.
- 2025.01.13 아이폰 사용자 이미지가 업로드되지 않는 문제 (HEIC 확장자 및 고용량이 원인)
  - 해결 방법 3가지(jpg로 확장자는 통일)
    - **클라이언트 측에서 jpg로 확장자 변환 및 압축 후 서버로 전송**            << 클라이언트 고사양 시대에 클라이언트에 부담을 주는 게 맞는 거 같아서 O
      - heic2any 라이브러리 이용 중 최신 아이폰 기종의 heic는 변환이 되지 않는 문제가 있음. issue 해결되지 않음, 따라서 heic-to 라이브러리를 이용
    - 백엔드에서 jpg로 확장자 변환 및 압축 후 S3로 업로드                          << EC2 프리티어 인스턴스 기준으로 서버에 부담을 주고싶지는 않아서 X
    - 백엔드 -> S3로 전송 후 S3에서 lambda로 처리                                 << AWS 람다 이용 비용 원치 않아서 X

# 🛠️ 기술 스택
### 백엔드
- JAVA / Spring Boot(Spring Data JPA, Spring Security)
### 프론트엔드
- Typescript / Next.js
### 데이터베이스
- MySQL 8.4
### 인프라 및 서버
- AWS(EC2, S3, ELB, Route53), GCP(Cloud SQL), Nginx
### 도구
- Git, Postman


