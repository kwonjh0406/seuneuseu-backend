# SNS 플랫폼 스느스

## 소개
2024년 12월에 시작된 프로젝트이며, 개발부터 운영까지의 전 과정을 경험해 보기 위해 진행한 개인 프로젝트입니다.

서비스 이용 > https://www.seuneuseu.com

## 기술 스택
AWS(EC2, S3, ELB, Route 53, VPC), GCP, Oracle Cloud, Java/Spring Boot, Next.js, Nginx, MySQL

## 이슈
- 발생 (2025.03.27) Cloud SQL GCP 프리티어 종료로 인한 데이터베이스 서버 가동 중단
  - ~~해결 (2025.03.28) 데이터베이스 서버 Oracle Cloud로 마이그레이션~~
  - 해결 (2025.03.30) 전체 서비스 Oracle Cloud로 마이그레이션 완료

---
## 서비스 아키텍처
![제목 없는 다이어그램-2-2 drawio](https://github.com/user-attachments/assets/59ca8841-7466-47c1-a8e8-2522bb45729d)


# 기능
- 구글 로그인
- 게시글 작성/수정/삭제
- 댓글 및 답글 작성/삭제
- 팔로우/팔로잉 및 팔로잉 게시글 모아보기
- 사용자 검색
- 프로필 수정

# 개발
- 게시글의 댓글 수는 실제 데이터의 갯수를 세는 것이 아닌 '댓글 수'라는 필드를 이용하여 동기화를 하고 있기에 동시성 문제가 발생할 수 있었습니다.
  - 해결 방법 3가지가 존재하며 낙관적 락으로 해결하였습니다.
> - 비관적 락: 댓글 수 변동 시 실제 디비에 락 걸고 업데이트 < 충돌이 잦은 경우에는 오히려 효율적이다(불났을 때 한 줄로 질서정연하게 대피하는 느낌). 핫한 게시물인 경우를 제외하면 충돌 상황이 거의 발생하지 않는다.
> - 낙관적 락: 마지막 디비 업데이트 시간 값을 바탕으로 데이터 변경 체크 < 충돌이 잦은 경우 롤백 후 재시도 하는 낙관적 락 특성상 문제가 될 수 있다. 하지만 우리 서비스에서는 그럴 일이 많지 않다.
> - 주기적으로 댓글 개수를 아무런 제약 없이 업데이트를 진행 후 일정 주기마다 데이터 동기화 < 특정 시점에 서버에 부하가 걸린다.
- 게시글 목록 API가 호출될 때 다수의 쿼리가 날아가는 문제가 발생했습니다.
  - 이는 게시글을 불러올 때 사용자 프로필 정보와 게시글 이미지 테이블에서 이미지 정보를 가져오는데 JPA의 N + 1 문제가 발생한 것입니다.
    - fetch join 방식을 이용하여 해결하였는데 JAVA 페이징을 fetch join과 함께 사용할 수 없기 때문에, 페이징 처리할 게시글 아이디 값들을 따로 추출한 후 이 값으로 직접 페이징 처리를 구현하였습니다.

# 이슈
- 2025.01.12 : CORS 문제 발생
  - 원인 : 도메인 이름으로 접근 시에 https(443)가 아닌 http(80)로 접근이 되어서 발생하던 문제였습니다. CORS뿐만 아니라 평문으로 전송하는 HTTP로 인해 민감한 쿠키 정보가 백엔드로 전송되지 않아 정상적으로 서비스를 이용할 수 없습니다.
  - 해결 : AWS ALB에서 80포트에 리스너를 설정하여 http로 접근 시 https로 리다이렉션 되도록 설정하여 해결했습니다.
- 2025.01.13 아이폰 사용자 이미지가 업로드되지 않는 문제 (HEIC 확장자 및 고용량이 원인)
  - 해결 방법 3가지(jpg로 확장자는 통일)
    - **클라이언트 측에서 jpg로 확장자 변환 및 압축 후 서버로 전송**
      - heic2any 라이브러리 이용 중 최신 아이폰 기종의 heic는 변환이 되지 않는 문제가 있음. issue 해결되지 않음, 따라서 heic-to 라이브러리를 이용
    - 백엔드에서 jpg로 확장자 변환 및 압축 후 S3로 업로드
    - 백엔드 -> S3로 전송 후 S3에서 lambda로 처리
